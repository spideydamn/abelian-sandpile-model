# Модель песчаной кучи

## Описание

Реализация упрощенной [модели песчаной кучи](https://en.wikipedia.org/wiki/Abelian_sandpile_model) с возможностью сохранения состояний в формате BMP. Программа имитирует поведение песчаной кучи, где песчинки распределяются по сетке согласно определенным правилам, и визуализирует процесс на каждой итерации.

## Особенности

- Чтение начального состояния из TSV-файла
- Динамическое расширение сетки при выходе песчинок за границы
- Визуализация состояний в формате BMP с цветовой кодировкой
- Поддержка настройки количества итераций и частоты сохранения

## Требования

- Компилятор C++ с поддержкой C++17
- CMake ≥ 3.10
- Стандартная библиотека C++

## Использование

Программа принимает следующие аргументы командной строки:

```
./abelian_sandpile [OPTIONS]
```

**Обязательные параметры:**
- `-i, --input` - путь к TSV-файлу с начальными данными
- `-o, --output` - путь к директории для сохранения BMP-файлов
- `-m, --max-iter` - максимальное количество итераций

**Дополнительные параметры:**
- `-f, --freq` - частота сохранения состояний (0 - только последнее состояние)

### Пример запуска

```bash
./abelian_sandpile -i input.txt -o output_dir -m 1000 -f 10
```

## Формат входных данных

Входной TSV-файл должен содержать три колонки, разделенные табуляцией:
- Координата X (int16_t)
- Координата Y (int16_t)
- Количество песчинок (uint64_t)

Пример:
```
0   0   4
1   0   3
0   1   2
```

## Формат выходных данных

Программа генерирует BMP-файлы в указанной директории. Каждый пиксель соответствует ячейке сетки с цветовой кодировкой:

- 0 песчинок - белый
- 1 песчинка - зеленый
- 2 песчинки - желтый
- 3 песчинки - фиолетовый
- >3 песчинок - черный

Имена файлов формируются по шаблону: `state_<номер_итерации>.bmp`

## Алгоритм

1. Инициализация сетки на основе входных данных
2. На каждой итерации:
   - Проверка ячеек с ≥4 песчинками
   - Перераспределение песчинок в соседние ячейки
   - Динамическое расширение сетки при необходимости
3. Сохранение состояния согласно заданной частоте

## Структура проекта

```
├── CMakeLists.txt
├── bin
│   └── main.cpp
├── lib
│   ├── AbelianSandpileModel.h
│   └── AbelianSandpileModel.cpp
└── README.md
```

## Ограничения

- Запрещено использование сторонних библиотек
- Запрещено использование контейнеров стандартной библиотеки
- Размеры координат ограничены int16_t
- Количество песчинок ограничено uint64_t

## Примечания

- Программа использует 4-битное кодирование пикселей в BMP-файлах
- Размер сетки автоматически расширяется при необходимости
- Цветовая палитра фиксирована и соответствует условиям задачи